--ILACLAR TABLOSU OLUSTURMA

--create table BARKODLAR(ID int PRIMARY KEY, BARKOD uniqueidentifier)

--create table ILACBARKODLARI(ID int, ILAC_ID int PRIMARY KEY, BARKOD_ID int)

--create table ILACLAR(ID int PRIMARY KEY, AD nvarchar(20), ADET int)



--birebir iliski
--ALTER TABLE ILACBARKODLARI 
--ADD  CONSTRAINT FK_ILACBARKODLARI_ILACLAR
--FOREIGN KEY (ILAC_ID)
--REFERENCES ILACLAR(ID)


--bire cok iliski
--ALTER TABLE ILACBARKODLARI
--ADD CONSTRAINT FK_ILACBARKODLARI_BARKODLAR
--FOREIGN KEY(BARKOD_ID)
--REFERENCES BARKODLAR(ID)


--OTOMATİK İLAÇ ID Yİ ILACBARKODLARA EKLEYEN TRIGGER
--CREATE TRIGGER idekle
--ON ILACLAR
--AFTER INSERT
--AS
--DECLARE @ID int
--DECLARE @ID=ID FROM INSERTED
--INSERT INTO ILACBARKODLARI(ILAC_ID) VALUES (@ID)



--ilacekle triggerı
--CREATE TRIGGER ilacekle
--ON ILACLAR
--INSTEAD OF INSERT
--AS
--DECLARE @ID INT,@AD nvarchar(20), @ADET INT ,@BARKOD_ID INT
--SELECT @ID=ID ,@AD=AD, @ADET=ADET  @BARKOD_ID=ID FROM INSERTED
--INSERT INTO ILACLAR(ID,AD,ADET) VALUES (@ID,@AD,@ADET)
--INSERT INTO ILACBARKODLARI(ILAC_ID,BARKOD_ID) VALUES (@ID,@BARKOD_ID)


--ilacsilme triggerı
--CREATE TRIGGER ilacsil ON ILACLAR 
--INSTEAD OF DELETE
--AS
--BEGİN
--DECLARE @ID INT
--SELECT @ID=ID FROM DELETED
--DELETE FROM ILACBARKODLARI where @ID=ID 
--PRINT 'KAYIT SİLİNDİ'
--END


--random barkod olusturan procedure
--CREATE PROCEDURE barkodolustur
--AS
--DECLARE @barkod_id INT
--DECLARE @ilac_id INT
--SET @barkod_id=RAND()*4500
--BEGIN
--INSERT INTO BARKODLAR(ID,BARKOD) VALUES (@barkod_id,NEWID())
--END

--CREATE PROCEDURE barkod_araA
--@BARKOD  AS VARCHAR(100)
--AS
--BEGIN
--SELECT 
--DB.BARKOD_ID as BARKOD,D.AD,D.ADET
--FROM ILACBARKODLARI DB
--LEFT JOIN ILACLAR D ON D.ID=DB.ILAC_ID JOIN BARKODLAR B ON DB.BARKOD_ID=B.ID
--WHERE BARKOD=@BARKOD
--END

--barkodarama prcedure
--CREATE PROCEDURE barkodara
--@BARKOD  AS VARCHAR(100)
--AS
--BEGIN
--SELECT 
--DB.BARKOD_ID as BARKOD_ID,D.ID,D.AD,D.ADET,B.BARKOD
--FROM ILACBARKODLARI DB
--LEFT JOIN ILACLAR D ON D.ID=DB.ILAC_ID JOIN BARKODLAR B ON DB.BARKOD_ID=B.ID
--WHERE BARKOD=@BARKOD
--END


--barkod ararken kullanılacak sorgu tırnak kısmına barkod yazılmalı
--exec barkodaraaa 'bc6a5e8f-6f64-4592-883b-15d110dc7543' 
--go

--barkod eklenecekse kullanılacak komut
--exec barkodolustur
--go


--SELECT
--ILACLAR.ID, ILACLAR.AD, ILACLAR.ADET  FROM ILACLAR JOIN ILACBARKODLARI ON ILACLAR.ID=ILACBARKODLARI.ILAC_ID 
--JOIN BARKODLAR ON BARKODLAR.ID=ILACBARKODLARI.BARKOD_ID 

--SORGULAR
--SELECT p.ID, p.AD, d.BARKOD_ID ,b.BARKOD from  ILACLAR p, ILACBARKODLARI d , BARKODLAR b WHERE b.ID= d.BARKOD_ID AND p.ID=d.ILAC_ID
--GO







